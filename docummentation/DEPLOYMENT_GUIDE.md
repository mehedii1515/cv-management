# Deployment Guide: Vercel + Render

This guide covers deploying the Resume Parser application with:
- Frontend (Next.js) on Vercel
- Backend (Django) + PostgreSQL on Render

## Prerequisites

- GitHub repository with your code
- Vercel account
- Render account
- API keys (OpenAI and/or Gemini)

## 1. Backend Deployment on Render

### Step 1: Create PostgreSQL Database
1. Go to Render Dashboard
2. Click "New" → "PostgreSQL"
3. Configure:
   - Name: `resume-parser-db`
   - Database Name: `resume_parser`
   - User: `resume_parser_user`
   - Region: Choose closest to your users
4. Click "Create Database"
5. Note the connection details for later

### Step 2: Deploy Backend Service
1. Click "New" → "Web Service"
2. Connect your GitHub repository
3. Configure:
   - Name: `resume-parser-backend`
   - Environment: `Python 3`
   - Build Command:
     ```bash
     cd backend && pip install -r requirements.txt && python manage.py collectstatic --noinput && python manage.py migrate
     ```
   - Start Command:
     ```bash
     cd backend && gunicorn resume_parser.wsgi:application
     ```

### Step 3: Set Environment Variables
The render.yaml file is pre-configured with your API keys, but you can also set these manually in Render:

```env
DEBUG=False
SECRET_KEY=<auto-generated-by-render>
DATABASE_URL=<auto-populated-from-database>
ALLOWED_HOSTS=your-backend-app.onrender.com
OPENAI_API_KEY=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
OPENAI_MODEL=gpt-3.5-turbo-1106
GEMINI_API_KEY=AIzaSyAx33CQKJHzGn2PxEEzY7r6mTvN_GILOuI
GEMINI_MODEL=gemini-1.5-flash
AI_PROVIDER=gemini
MAX_UPLOAD_SIZE=10485760
ALLOWED_FILE_TYPES=pdf,docx,txt
MCP_SERVER_PORT=3001
FRONTEND_URL=https://your-frontend-app.vercel.app
```

### Step 4: Add Persistent Disk (Optional)
1. In your service settings, add a disk:
   - Name: `resume-parser-disk`
   - Mount Path: `/opt/render/project/src/backend/media`
   - Size: 1GB (or as needed)

## 2. Frontend Deployment on Vercel

### Step 1: Deploy to Vercel
1. Go to Vercel Dashboard
2. Click "New Project"
3. Import your GitHub repository
4. Configure:
   - Framework Preset: Next.js
   - Root Directory: `frontend`
   - Build Command: `npm run build`
   - Output Directory: `.next`

### Step 2: Set Environment Variables
Add this environment variable in Vercel:

```env
NEXT_PUBLIC_API_URL=https://your-backend-app.onrender.com/api
```

### Step 3: Update Backend CORS
After deployment, update your backend's `FRONTEND_URL` environment variable with your Vercel domain:
```env
FRONTEND_URL=https://your-frontend-app.vercel.app
```

## 3. Post-Deployment Steps

### Test the Deployment
1. Visit your Vercel frontend URL
2. Try uploading a resume
3. Check that the API calls work correctly

### Monitor Logs
- **Render**: Check logs in your service dashboard
- **Vercel**: Check function logs in your project dashboard

### Set Up Custom Domains (Optional)
- **Vercel**: Add custom domain in project settings
- **Render**: Add custom domain in service settings

## 4. Troubleshooting

### Common Issues

**Backend not starting:**
- Check build logs for Python/Django errors
- Verify all environment variables are set
- Ensure DATABASE_URL is correctly configured

**CORS errors:**
- Verify FRONTEND_URL is set correctly in backend
- Check ALLOWED_HOSTS includes your Render domain

**File upload issues:**
- Ensure persistent disk is mounted correctly
- Check file size limits in environment variables

**Database connection errors:**
- Verify DATABASE_URL is auto-populated
- Check PostgreSQL database is running

### Performance Optimization

**Backend (Render):**
- Use appropriate instance size
- Enable auto-scaling if needed
- Monitor memory usage

**Frontend (Vercel):**
- Optimize images and assets
- Use Vercel Analytics for performance insights
- Enable Edge Functions if needed

## 5. Environment Variables Reference

### Backend (Render)
```env
DEBUG=False
SECRET_KEY=<auto-generated>
DATABASE_URL=<auto-populated>
ALLOWED_HOSTS=your-backend.onrender.com
OPENAI_API_KEY=sk-...
GEMINI_API_KEY=...
AI_PROVIDER=both
MAX_UPLOAD_SIZE=10485760
ALLOWED_FILE_TYPES=pdf,docx,txt
FRONTEND_URL=https://your-frontend.vercel.app
```

### Frontend (Vercel)
```env
NEXT_PUBLIC_API_URL=https://your-backend.onrender.com/api
```

## 6. Maintenance

### Database Backups
- Render automatically backs up PostgreSQL databases
- Consider setting up additional backup strategies for production

### Updates
- Push to your main branch to trigger automatic deployments
- Monitor deployment status in both platforms

### Scaling
- **Render**: Upgrade instance size or enable auto-scaling
- **Vercel**: Automatically scales based on traffic

## 7. Security Considerations

- Keep API keys secure and rotate regularly
- Use strong SECRET_KEY in production
- Enable HTTPS (automatic on both platforms)
- Monitor access logs for suspicious activity
- Consider rate limiting for API endpoints

## Support

If you encounter issues:
1. Check the troubleshooting section above
2. Review deployment logs on both platforms
3. Verify all environment variables are correctly set
4. Test API endpoints directly using the backend URL